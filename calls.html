<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Notes - Mawney Partners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9f7f3;
            color: #2d2926;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #004b35;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header-text {
            flex: 1;
            text-align: center;
        }
        
        .header-logo {
            flex-shrink: 0;
            margin-left: 20px;
        }
        
        .logo {
            height: 30px;
            width: auto;
            opacity: 0.9;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .add-call-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .recording-section {
            background: #fee;
            border: 1px solid #fcc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
        }
        
        .recording-section.active {
            display: block;
        }
        
        .recording-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .recording-indicator {
            display: flex;
            align-items: center;
        }
        
        .recording-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff4444;
            margin-right: 8px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .recording-text {
            font-weight: 600;
            color: #ff4444;
        }
        
        .stop-button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .stop-button:hover {
            background: #cc3333;
        }
        
        .transcription-container {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .transcription-label {
            font-weight: 600;
            color: #2d2926;
            margin-bottom: 8px;
        }
        
        .transcription-text {
            color: #4d4742;
            line-height: 1.5;
            min-height: 60px;
        }
        
        .add-call-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2d2926;
        }
        
        .form-input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            min-height: 100px;
            resize: vertical;
        }
        
        .add-button {
            background: #004b35;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
        }
        
        .calls-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #004b35;
            margin-bottom: 15px;
        }
        
        .call-item {
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 0;
        }
        
        .call-item:last-child {
            border-bottom: none;
        }
        
        .call-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d2926;
            margin-bottom: 5px;
        }
        
        .call-meta {
            color: #4d4742;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .call-notes {
            color: #4d4742;
            line-height: 1.4;
            font-size: 0.9rem;
        }
        
        .delete-button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .nav-bar {
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.3s;
            text-decoration: none;
            color: #2d2926;
            border: none;
            background: none;
        }
        
        .nav-item:visited {
            color: #2d2926;
            text-decoration: none;
        }
        
        .nav-item:link {
            color: #2d2926;
            text-decoration: none;
        }        
        .nav-item:hover {
            background: #f0f0f0;
        }
        
        .nav-item.active {
            background: #004b35;
            color: white;
        }
        
        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .nav-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #4d4742;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <button class="back-button" onclick="goBack()">←</button>
            <div class="header-content"><div class="header-text"><h1>Call Notes</h1>
            <p>Track Your Conversations</p></div><div class="header-logo"><img src="assets/logo.png" alt="Mawney Partners Logo" class="logo"></div></div>
        </div>
        
        <div class="main-content">
            <!-- Recording Section -->
            <div id="recordingSection" class="recording-section">
                <div class="recording-header">
                    <div class="recording-indicator">
                        <div class="recording-dot"></div>
                        <span class="recording-text">Recording...</span>
                    </div>
                    <button class="stop-button" onclick="stopRecording()">Stop Recording</button>
                </div>
                <div class="transcription-container">
                    <div class="transcription-label">Live Transcription:</div>
                    <div id="transcriptionText" class="transcription-text">Listening for speech...</div>
                </div>
            </div>
            
            <!-- Add Call Section -->
            <div class="add-call-section">
                <div class="add-call-form">
                    <div class="form-group">
                        <label for="callTitle">Call Title</label>
                        <input type="text" class="form-input" id="callTitle" placeholder="e.g., Client Meeting with ABC Corp">
                    </div>
                    
                    <div class="form-group">
                        <label for="callDate">Date</label>
                        <input type="date" class="form-input" id="callDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="callNotes">Notes</label>
                        <textarea class="form-textarea" id="callNotes" placeholder="Enter your call notes here..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="add-button" onclick="addCall()" style="flex: 1;">Add Call Note</button>
                        <button class="add-button" onclick="startRecording()" style="flex: 1; background: #ff4444;">Start Recording</button>
                    </div>
                </div>
            </div>
            
            <!-- Calls List -->
            <div class="calls-section">
                <h2 class="section-title">Your Call Notes</h2>
                <div id="callsList">
                    <div class="empty-state">No call notes yet. Add one above!</div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar -->
        <div class="nav-bar">
            <a href="index.html" class="nav-item">
                <div class="nav-icon">⌂</div>
                <div class="nav-label">Home</div>
            </a>
            <a href="chat.html" class="nav-item">
                <div class="nav-icon">◉</div>
                <div class="nav-label">Chat</div>
            </a>
            <a href="profile.html" class="nav-item">
                <div class="nav-icon">⚙</div>
                <div class="nav-label">Profile</div>
            </a>
        </div>
    </div>

    <script>
        // User data
        let currentUser = null;
        let calls = [];
        let isRecording = false;
        let currentCall = null;
        let recordingInterval = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            loadCalls();
            setDefaultDate();
        });
        
        // Check if user is logged in
        function checkAuthStatus() {
            const savedUser = localStorage.getItem('mawney_user');
            if (!savedUser) {
                window.location.href = 'index.html';
                return;
            }
            currentUser = JSON.parse(savedUser);
        }
        
        // Go back to home
        function goBack() {
            window.location.href = 'index.html';
        }
        
        // Set default date to today
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('callDate').value = today;
        }
        
        // Load calls from localStorage
        function loadCalls() {
            const savedCalls = localStorage.getItem(`calls_${currentUser.id}`);
            if (savedCalls) {
                calls = JSON.parse(savedCalls);
            }
            displayCalls();
        }
        
        // Save calls to localStorage
        function saveCalls() {
            localStorage.setItem(`calls_${currentUser.id}`, JSON.stringify(calls));
        }
        
        // Display calls
        function displayCalls() {
            const callsList = document.getElementById('callsList');
            
            if (calls.length === 0) {
                callsList.innerHTML = '<div class="empty-state">No call notes yet. Add one above!</div>';
                return;
            }
            
            // Sort calls by date (newest first)
            const sortedCalls = calls.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const callsHTML = sortedCalls.map((call, index) => `
                <div class="call-item">
                    <div class="call-title">${call.title}</div>
                    <div class="call-meta">Date: ${new Date(call.date).toLocaleDateString()}</div>
                    <div class="call-notes">${call.notes}</div>
                    <button class="delete-button" onclick="deleteCall(${index})">Delete</button>
                </div>
            `).join('');
            
            callsList.innerHTML = callsHTML;
        }
        
        // Add new call
        function addCall() {
            const title = document.getElementById('callTitle').value.trim();
            const date = document.getElementById('callDate').value;
            const notes = document.getElementById('callNotes').value.trim();
            
            if (title === '' || notes === '') {
                alert('Please fill in both title and notes');
                return;
            }
            
            calls.push({
                title: title,
                date: date,
                notes: notes,
                createdAt: new Date().toISOString()
            });
            
            // Clear form
            document.getElementById('callTitle').value = '';
            document.getElementById('callNotes').value = '';
            setDefaultDate();
            
            saveCalls();
            displayCalls();
        }
        
        // Delete call
        function deleteCall(index) {
            if (confirm('Are you sure you want to delete this call note?')) {
                calls.splice(index, 1);
                saveCalls();
                displayCalls();
            }
        }
        
        // Recording functions
        function startRecording() {
            if (isRecording) return;
            
            if (confirm('Start Call Recording\n\nThis will begin recording and transcribing your phone call. Make sure you have permission to record.')) {
                isRecording = true;
                currentCall = {
                    id: Date.now(),
                    startTime: new Date().toISOString(),
                    title: 'Call Recording',
                    transcription: '',
                    notes: '',
                    participants: '',
                    status: 'recording'
                };
                
                // Show recording section
                document.getElementById('recordingSection').classList.add('active');
                
                // Simulate transcription process
                simulateTranscription();
            }
        }
        
        function stopRecording() {
            if (!isRecording) return;
            
            if (confirm('Stop Recording\n\nAre you sure you want to stop recording this call?')) {
                isRecording = false;
                
                if (currentCall) {
                    currentCall.endTime = new Date().toISOString();
                    currentCall.status = 'completed';
                    
                    // Add to calls list
                    calls.unshift(currentCall);
                    saveCalls();
                    displayCalls();
                }
                
                // Hide recording section
                document.getElementById('recordingSection').classList.remove('active');
                
                // Clear interval
                if (recordingInterval) {
                    clearInterval(recordingInterval);
                    recordingInterval = null;
                }
                
                currentCall = null;
            }
        }
        
        function simulateTranscription() {
            const transcriptionText = document.getElementById('transcriptionText');
            const sampleTranscriptions = [
                "Hello, this is John from ABC Corp. How are you today?",
                "I wanted to discuss the quarterly results and our upcoming projects.",
                "The market conditions have been challenging, but we're seeing some positive trends.",
                "What are your thoughts on the new regulatory changes?",
                "I think we should schedule a follow-up meeting next week.",
                "Thank you for your time today. I'll send you the summary by email."
            ];
            
            let currentIndex = 0;
            let currentText = "";
            
            recordingInterval = setInterval(() => {
                if (currentIndex < sampleTranscriptions.length) {
                    currentText += sampleTranscriptions[currentIndex] + " ";
                    transcriptionText.textContent = currentText;
                    currentCall.transcription = currentText;
                    currentIndex++;
                } else {
                    // Add more realistic transcription
                    currentText += "The call is continuing... ";
                    transcriptionText.textContent = currentText;
                    currentCall.transcription = currentText;
                }
            }, 3000);
        }
    </script>
</body>
</html>
