<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Notes - Mawney Partners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9f7f3;
            color: #2d2926;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #004b35;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header-text {
            flex: 1;
            text-align: center;
        }
        
        .header-logo {
            flex-shrink: 0;
            margin-left: 20px;
        }
        
        .logo {
            height: 30px;
            width: auto;
            opacity: 0.9;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .add-call-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .recording-section {
            background: #fee;
            border: 1px solid #fcc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
        }
        
        .recording-section.active {
            display: block;
        }
        
        .recording-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .recording-indicator {
            display: flex;
            align-items: center;
        }
        
        .recording-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff4444;
            margin-right: 8px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .recording-text {
            font-weight: 600;
            color: #ff4444;
        }
        
        .stop-button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .stop-button:hover {
            background: #cc3333;
        }
        
        .transcription-container {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .transcription-label {
            font-weight: 600;
            color: #2d2926;
            margin-bottom: 8px;
        }
        
        .transcription-text {
            color: #4d4742;
            line-height: 1.5;
            min-height: 60px;
        }
        
        /* Popup Modal Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .popup-overlay.active {
            display: flex;
        }
        
        .popup-container {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .popup-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d2926;
        }
        
        .close-button {
            font-size: 1.5rem;
            color: #4d4742;
            cursor: pointer;
            font-weight: bold;
        }
        
        .popup-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
        }
        
        .edit-section {
            margin-bottom: 16px;
        }
        
        .edit-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2d2926;
            margin-bottom: 8px;
            display: block;
        }
        
        .edit-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .edit-display {
            font-size: 1rem;
            color: #2d2926;
            padding: 8px 0;
        }
        
        .full-transcription-text {
            font-size: 0.9rem;
            color: #2d2926;
            line-height: 1.5;
            background: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            white-space: pre-wrap;
        }
        
        .full-notes-text {
            font-size: 0.9rem;
            color: #2d2926;
            line-height: 1.5;
            background: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            white-space: pre-wrap;
        }
        
        .popup-actions {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .edit-button, .cancel-button, .save-button {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
        }
        
        .edit-button {
            background: #004b35;
            color: white;
        }
        
        .cancel-button {
            background: #f0f0f0;
            color: #2d2926;
            margin-right: 10px;
        }
        
        .save-button {
            background: #266b52;
            color: white;
        }
        
        .edit-button:hover, .cancel-button:hover, .save-button:hover {
            opacity: 0.9;
        }
        
        .add-call-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2d2926;
        }
        
        .form-input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            min-height: 100px;
            resize: vertical;
        }
        
        .add-button {
            background: #004b35;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
        }
        
        .calls-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #004b35;
            margin-bottom: 15px;
        }
        
        .call-item {
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 0;
        }
        
        .call-item:last-child {
            border-bottom: none;
        }
        
        .call-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d2926;
            margin-bottom: 5px;
        }
        
        .call-meta {
            color: #4d4742;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .call-notes {
            color: #4d4742;
            line-height: 1.4;
            font-size: 0.9rem;
        }
        
        .delete-button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .nav-bar {
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.3s;
            text-decoration: none;
            color: #2d2926;
            border: none;
            background: none;
        }
        
        .nav-item:visited {
            color: #2d2926;
            text-decoration: none;
        }
        
        .nav-item:link {
            color: #2d2926;
            text-decoration: none;
        }        
        .nav-item:hover {
            background: #f0f0f0;
        }
        
        .nav-item.active {
            background: #004b35;
            color: white;
        }
        
        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .nav-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #4d4742;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <button class="back-button" onclick="goBack()">←</button>
            <div class="header-content"><div class="header-text"><h1>Call Notes</h1>
            <p>Track Your Conversations</p></div><div class="header-logo"><img src="assets/logo.png" alt="Mawney Partners Logo" class="logo"></div></div>
        </div>
        
        <div class="main-content">
            <!-- Recording Section -->
            <div id="recordingSection" class="recording-section">
                <div class="recording-header">
                    <div class="recording-indicator">
                        <div class="recording-dot"></div>
                        <span class="recording-text">Recording...</span>
                    </div>
                    <button class="stop-button" onclick="stopRecording()">Stop Recording</button>
                </div>
            <div class="transcription-container">
                <div class="transcription-label">Live Transcription:</div>
                <div id="transcriptionText" class="transcription-text">Click "Start Recording" to begin...</div>
                <div class="recording-status" id="recordingStatus" style="font-size: 0.8rem; color: #666; margin-top: 8px;">
                    <span id="statusText">Ready to record</span>
                </div>
            </div>
            </div>
            
            <!-- Add Call Section -->
            <div class="add-call-section">
                <div class="add-call-form">
                    <div class="form-group">
                        <label for="callTitle">Call Title</label>
                        <input type="text" class="form-input" id="callTitle" placeholder="e.g., Client Meeting with ABC Corp">
                    </div>
                    
                    <div class="form-group">
                        <label for="callDate">Date</label>
                        <input type="date" class="form-input" id="callDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="callNotes">Notes</label>
                        <textarea class="form-textarea" id="callNotes" placeholder="Enter your call notes here..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="add-button" onclick="addCall()" style="flex: 1;">Add Call Note</button>
                        <button class="add-button" onclick="startRecording()" style="flex: 1; background: #ff4444;">Start Recording</button>
                    </div>
                </div>
            </div>
            
            <!-- Calls List -->
            <div class="calls-section">
                <h2 class="section-title">Your Call Notes</h2>
                <div id="callsList">
                    <div class="empty-state">No call notes yet. Add one above!</div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar -->
        <div class="nav-bar">
            <a href="index.html" class="nav-item">
                <div class="nav-icon">⌂</div>
                <div class="nav-label">Home</div>
            </a>
            <a href="chat.html" class="nav-item">
                <div class="nav-icon">◉</div>
                <div class="nav-label">Chat</div>
            </a>
            <a href="profile.html" class="nav-item">
                <div class="nav-icon">⚙</div>
                <div class="nav-label">Profile</div>
            </a>
        </div>
        
        <!-- Call Note Details Popup -->
        <div id="popupOverlay" class="popup-overlay">
            <div class="popup-container">
                <div class="popup-header">
                    <h3 class="popup-title">Call Note Details</h3>
                    <span class="close-button" onclick="closeNotePopup()">×</span>
                </div>
                
                <div class="popup-content">
                    <!-- Editable Fields -->
                    <div class="edit-section">
                        <label class="edit-label">Title:</label>
                        <input type="text" id="editTitle" class="edit-input" style="display: none;" placeholder="Enter call title">
                        <div id="editTitleDisplay" class="edit-display"></div>
                    </div>
                    
                    <div class="edit-section">
                        <label class="edit-label">Date:</label>
                        <input type="date" id="editDate" class="edit-input" style="display: none;">
                        <div id="editDateDisplay" class="edit-display"></div>
                    </div>
                    
                    <div class="edit-section">
                        <label class="edit-label">Time:</label>
                        <input type="time" id="editTime" class="edit-input" style="display: none;">
                        <div id="editTimeDisplay" class="edit-display"></div>
                    </div>
                    
                    <!-- Full Transcription -->
                    <div id="transcriptionSection" class="edit-section" style="display: none;">
                        <label class="edit-label">Full Transcription:</label>
                        <div id="fullTranscriptionText" class="full-transcription-text"></div>
                    </div>
                    
                    <!-- Notes -->
                    <div id="notesSection" class="edit-section" style="display: none;">
                        <label class="edit-label">Notes:</label>
                        <div id="fullNotesText" class="full-notes-text"></div>
                    </div>
                </div>
                
                <div class="popup-actions">
                    <button id="editButton" class="edit-button" onclick="startEditing()">Edit</button>
                    <button id="cancelButton" class="cancel-button" onclick="cancelEdit()" style="display: none;">Cancel</button>
                    <button id="saveButton" class="save-button" onclick="saveEdit()" style="display: none;">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // User data
        let currentUser = null;
        let calls = [];
        let isRecording = false;
        let currentCall = null;
        let recordingInterval = null;
        let selectedNote = null;
        let isEditing = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let recognition = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            loadCalls();
            setDefaultDate();
            checkBrowserCompatibility();
        });
        
        // Check browser compatibility for recording features
        function checkBrowserCompatibility() {
            const statusText = document.getElementById('statusText');
            
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                statusText.textContent = 'Recording not supported - use Chrome, Firefox, or Edge';
                statusText.style.color = '#ff4444';
                return false;
            }
            
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                statusText.textContent = 'Speech recognition not supported - use Chrome or Edge';
                statusText.style.color = '#ff4444';
                return false;
            }
            
            statusText.textContent = 'Ready to record - browser compatible';
            statusText.style.color = '#266b52';
            return true;
        }
        
        // Check if user is logged in
        function checkAuthStatus() {
            const savedUser = localStorage.getItem('mawney_user');
            if (!savedUser) {
                window.location.href = 'index.html';
                return;
            }
            currentUser = JSON.parse(savedUser);
        }
        
        // Go back to home
        function goBack() {
            window.location.href = 'index.html';
        }
        
        // Set default date to today
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('callDate').value = today;
        }
        
        // Load calls from localStorage
        function loadCalls() {
            const savedCalls = localStorage.getItem(`calls_${currentUser.id}`);
            if (savedCalls) {
                calls = JSON.parse(savedCalls);
            }
            displayCalls();
        }
        
        // Save calls to localStorage
        function saveCalls() {
            localStorage.setItem(`calls_${currentUser.id}`, JSON.stringify(calls));
        }
        
        // Display calls
        function displayCalls() {
            const callsList = document.getElementById('callsList');
            
            if (calls.length === 0) {
                callsList.innerHTML = '<div class="empty-state">No call notes yet. Add one above!</div>';
                return;
            }
            
            // Sort calls by date (newest first)
            const sortedCalls = calls.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const callsHTML = sortedCalls.map((call, index) => {
                // Format date properly
                let dateDisplay = 'Unknown date';
                if (call.date) {
                    try {
                        const date = new Date(call.date);
                        if (!isNaN(date.getTime())) {
                            dateDisplay = date.toLocaleDateString();
                        }
                    } catch (e) {
                        dateDisplay = call.date; // Use raw date if parsing fails
                    }
                }
                
                return `
                    <div class="call-item" onclick="openNotePopup(calls[${calls.indexOf(call)}])" style="cursor: pointer;">
                        <div class="call-title">${call.title}</div>
                        <div class="call-meta">Date: ${dateDisplay}${call.time ? ` at ${call.time}` : ''}</div>
                        <div class="call-notes">${call.notes || call.transcription || 'No notes available'}</div>
                        <button class="delete-button" onclick="event.stopPropagation(); deleteCall(${index})">Delete</button>
                    </div>
                `;
            }).join('');
            
            callsList.innerHTML = callsHTML;
        }
        
        // Add new call
        function addCall() {
            const title = document.getElementById('callTitle').value.trim();
            const date = document.getElementById('callDate').value;
            const notes = document.getElementById('callNotes').value.trim();
            
            if (title === '' || notes === '') {
                alert('Please fill in both title and notes');
                return;
            }
            
            // Get current time
            const now = new Date();
            const time = now.toTimeString().split(' ')[0].substring(0, 5); // HH:MM format
            
            calls.push({
                id: Date.now(),
                title: title,
                date: date,
                time: time,
                notes: notes,
                createdAt: new Date().toISOString()
            });
            
            // Clear form
            document.getElementById('callTitle').value = '';
            document.getElementById('callNotes').value = '';
            setDefaultDate();
            
            saveCalls();
            displayCalls();
        }
        
        // Delete call
        function deleteCall(index) {
            if (confirm('Are you sure you want to delete this call note?')) {
                calls.splice(index, 1);
                saveCalls();
                displayCalls();
            }
        }
        
        // Recording functions
        async function startRecording() {
            if (isRecording) return;
            
            if (confirm('Start Call Recording\n\nThis will begin recording and transcribing your phone call. Make sure you have permission to record.')) {
                try {
                    // Request microphone access
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        } 
                    });
                    
                    isRecording = true;
                    
                    // Get current date and time
                    const now = new Date();
                    const date = now.toISOString().split('T')[0]; // YYYY-MM-DD format
                    const time = now.toTimeString().split(' ')[0].substring(0, 5); // HH:MM format
                    
                    currentCall = {
                        id: Date.now(),
                        startTime: new Date().toISOString(),
                        title: 'Call Recording',
                        date: date,
                        time: time,
                        transcription: '',
                        notes: '',
                        participants: '',
                        status: 'recording'
                    };
                    
                    // Show recording section
                    document.getElementById('recordingSection').classList.add('active');
                    
                    // Set up MediaRecorder
                    mediaRecorder = new MediaRecorder(stream, {
                        mimeType: 'audio/webm;codecs=opus'
                    });
                    
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        // You could upload this to a server for processing
                        console.log('Recording stopped, audio blob created:', audioBlob);
                    };
                    
                    // Start recording
                    mediaRecorder.start(1000); // Collect data every second
                    
                    // Set up speech recognition
                    setupSpeechRecognition();
                    
                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    alert('Error accessing microphone. Please check your permissions and try again.');
                }
            }
        }
        
        function stopRecording() {
            if (!isRecording) return;
            
            if (confirm('Stop Recording\n\nAre you sure you want to stop recording this call?')) {
                isRecording = false;
                
                // Stop media recorder
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
                
                // Stop speech recognition
                if (recognition) {
                    recognition.stop();
                }
                
                if (currentCall) {
                    currentCall.endTime = new Date().toISOString();
                    currentCall.status = 'completed';
                    
                    // Add to calls list
                    calls.unshift(currentCall);
                    saveCalls();
                    displayCalls();
                }
                
                // Hide recording section
                document.getElementById('recordingSection').classList.remove('active');
                
                // Clear interval
                if (recordingInterval) {
                    clearInterval(recordingInterval);
                    recordingInterval = null;
                }
                
                currentCall = null;
            }
        }
        
        function setupSpeechRecognition() {
            // Check if speech recognition is supported
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                console.warn('Speech recognition not supported in this browser');
                document.getElementById('transcriptionText').textContent = 'Speech recognition not supported in this browser';
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            
            let fullTranscript = '';
            
            recognition.onstart = () => {
                console.log('Speech recognition started');
                document.getElementById('transcriptionText').textContent = 'Listening for speech...';
                document.getElementById('statusText').textContent = 'Speech recognition active - speak clearly';
            };
            
            recognition.onresult = (event) => {
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    
                    if (event.results[i].isFinal) {
                        fullTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                const displayText = fullTranscript + interimTranscript;
                document.getElementById('transcriptionText').textContent = displayText;
                
                if (currentCall) {
                    currentCall.transcription = displayText;
                }
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                document.getElementById('transcriptionText').textContent = `Speech recognition error: ${event.error}`;
                document.getElementById('statusText').textContent = `Error: ${event.error}`;
            };
            
            recognition.onend = () => {
                console.log('Speech recognition ended');
                if (isRecording) {
                    // Restart recognition if still recording
                    setTimeout(() => {
                        if (isRecording) {
                            recognition.start();
                        }
                    }, 100);
                }
            };
            
            // Start recognition
            recognition.start();
        }
        
        // Popup functions
        function openNotePopup(note) {
            selectedNote = note;
            document.getElementById('popupOverlay').classList.add('active');
            
            // Populate fields
            document.getElementById('editTitleDisplay').textContent = note.title || '';
            document.getElementById('editDateDisplay').textContent = note.date || 'No date set';
            document.getElementById('editTimeDisplay').textContent = note.time || 'No time set';
            
            // Show transcription if available
            if (note.transcription) {
                document.getElementById('transcriptionSection').style.display = 'block';
                document.getElementById('fullTranscriptionText').textContent = note.transcription;
            } else {
                document.getElementById('transcriptionSection').style.display = 'none';
            }
            
            // Show notes if available
            if (note.notes) {
                document.getElementById('notesSection').style.display = 'block';
                document.getElementById('fullNotesText').textContent = note.notes;
            } else {
                document.getElementById('notesSection').style.display = 'none';
            }
            
            // Reset edit mode
            isEditing = false;
            updateEditButtons();
        }
        
        function closeNotePopup() {
            document.getElementById('popupOverlay').classList.remove('active');
            selectedNote = null;
            isEditing = false;
        }
        
        function startEditing() {
            isEditing = true;
            
            // Populate input fields
            document.getElementById('editTitle').value = selectedNote.title || '';
            document.getElementById('editDate').value = selectedNote.date || '';
            document.getElementById('editTime').value = selectedNote.time || '';
            
            // Show inputs, hide displays
            document.getElementById('editTitle').style.display = 'block';
            document.getElementById('editTitleDisplay').style.display = 'none';
            document.getElementById('editDate').style.display = 'block';
            document.getElementById('editDateDisplay').style.display = 'none';
            document.getElementById('editTime').style.display = 'block';
            document.getElementById('editTimeDisplay').style.display = 'none';
            
            updateEditButtons();
        }
        
        function cancelEdit() {
            isEditing = false;
            
            // Show displays, hide inputs
            document.getElementById('editTitle').style.display = 'none';
            document.getElementById('editTitleDisplay').style.display = 'block';
            document.getElementById('editDate').style.display = 'none';
            document.getElementById('editDateDisplay').style.display = 'block';
            document.getElementById('editTime').style.display = 'none';
            document.getElementById('editTimeDisplay').style.display = 'block';
            
            updateEditButtons();
        }
        
        function saveEdit() {
            if (selectedNote) {
                // Update the note
                const title = document.getElementById('editTitle').value;
                const date = document.getElementById('editDate').value;
                const time = document.getElementById('editTime').value;
                
                selectedNote.title = title;
                selectedNote.date = date;
                selectedNote.time = time;
                
                // Update in calls array
                const index = calls.findIndex(call => call.id === selectedNote.id);
                if (index !== -1) {
                    calls[index] = selectedNote;
                    saveCalls();
                    displayCalls();
                }
                
                // Update display
                document.getElementById('editTitleDisplay').textContent = title;
                document.getElementById('editDateDisplay').textContent = date;
                document.getElementById('editTimeDisplay').textContent = time;
                
                cancelEdit();
            }
        }
        
        function updateEditButtons() {
            const editButton = document.getElementById('editButton');
            const cancelButton = document.getElementById('cancelButton');
            const saveButton = document.getElementById('saveButton');
            
            if (isEditing) {
                editButton.style.display = 'none';
                cancelButton.style.display = 'block';
                saveButton.style.display = 'block';
            } else {
                editButton.style.display = 'block';
                cancelButton.style.display = 'none';
                saveButton.style.display = 'none';
            }
        }
    </script>
</body>
</html>
